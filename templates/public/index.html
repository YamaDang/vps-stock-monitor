<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPS库存监控状态</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .title {
            margin: 0;
            color: #1f2329;
        }
        .update-time {
            color: #86909c;
            font-size: 0.9rem;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            color: #86909c;
            font-size: 0.9rem;
        }
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            .update-time {
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">VPS库存监控状态</h1>
            <div class="update-time">
                最后更新: <span id="last-update">加载中...</span>
            </div>
        </div>
        
        <div id="app">
            <el-card>
                <template #header>
                    监控商品列表
                </template>
                <el-table 
                    :data="stocks" 
                    border 
                    style="width: 100%;"
                    v-loading="loading">
                    <el-table-column 
                        prop="name" 
                        label="商品名称" 
                        sortable>
                    </el-table-column>
                    <el-table-column 
                        label="商品链接">
                        <template #default="scope">
                            <a :href="scope.row.url" target="_blank" class="link">
                                {{ scope.row.url.length > 50 ? scope.row.url.substring(0, 50) + '...' : scope.row.url }}
                            </a>
                        </template>
                    </el-table-column>
                    <el-table-column 
                        label="库存状态" 
                        sortable>
                        <template #default="scope">
                            <el-badge 
                                :value="scope.row.status ? '有货' : '无货'" 
                                :type="scope.row.status ? 'success' : 'danger'"
                                size="large">
                            </el-badge>
                        </template>
                    </el-table-column>
                    <el-table-column 
                        prop="last_changed" 
                        label="状态更新时间"
                        sortable>
                    </el-table-column>
                </el-table>
                
                <div v-if="stocks.length === 0 && !loading" class="empty-state">
                    <el-empty description="暂无监控商品数据"></el-empty>
                </div>
            </el-card>
            
            <div class="footer">
                <p>VPS库存监控系统 &copy; {{ new Date().getFullYear() }}</p>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        const { createApp, ref, onMounted, reactive, toRefs } = Vue;
        
        createApp({
            setup() {
                const stocks = ref([]);
                const loading = ref(true);
                
                // 获取库存数据
                const fetchStocks = async () => {
                    try {
                        loading.value = true;
                        const response = await axios.get('/api/public/stocks');
                        stocks.value = response.data || [];
                        
                        // 更新最后更新时间
                        document.getElementById('last-update').textContent = new Date().toLocaleString();
                    } catch (error) {
                        console.error('获取库存数据失败:', error);
                        stocks.value = [];
                    } finally {
                        loading.value = false;
                    }
                };
                
                // 初始化加载
                onMounted(() => {
                    fetchStocks();
                    
                    // 定时刷新，每30秒一次
                    setInterval(fetchStocks, 30000);
                });
                
                return {
                    stocks,
                    loading
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
